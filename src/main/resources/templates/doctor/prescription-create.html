<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>K√™ ƒë∆°n thu·ªëc m·ªõi - ABClinic</title>
    <!-- Theme Controller - MUST be first to prevent flash -->
    <script th:src="@{/js/core/theme-controller.js}"></script>

    <!-- Favicon -->
    <link rel="icon" type="image/jpeg" th:href="@{/images/Logo.jpg}" />
    <link rel="shortcut icon" type="image/jpeg" th:href="@{/images/Logo.jpg}" />

    <script src="https://cdn.tailwindcss.com"></script>
    <script th:src="@{/js/config/tailwind-config.js}"></script>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&display=swap"
    />
    <style>
      .material-symbols-outlined {
        font-variation-settings:
          "FILL" 0,
          "wght" 400,
          "GRAD" 0,
          "opsz" 24;
      }
      .material-symbols-outlined.fill {
        font-variation-settings: "FILL" 1;
      }
      ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 3px;
      }
      .dark ::-webkit-scrollbar-thumb {
        background: #475569;
      }
      .autocomplete-dropdown {
        max-height: 200px;
        overflow-y: auto;
      }
      .autocomplete-item:hover {
        background-color: #f1f5f9;
      }
      .dark .autocomplete-item:hover {
        background-color: #334155;
      }
    </style>
  </head>
  <body
    class="bg-slate-50 dark:bg-[#0f172a] text-slate-900 dark:text-slate-100 font-sans"
  >
    <div class="flex h-screen overflow-hidden">
      <!-- Sidebar -->
      <aside th:replace="~{fragments/doctor-layout :: doctor-sidebar}"></aside>

      <!-- Main Content -->
      <div class="flex-1 flex flex-col overflow-hidden">
        <!-- Top Header -->
        <header
          class="bg-white dark:bg-[#1a2634] border-b border-slate-200 dark:border-slate-800 px-6 py-4"
        >
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-4">
              <!-- Mobile menu button -->
              <button
                onclick="toggleSidebar()"
                class="lg:hidden p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg"
              >
                <span class="material-symbols-outlined">menu</span>
              </button>
              <div>
                <h1 class="text-xl font-bold text-slate-900 dark:text-white">
                  K√™ ƒë∆°n thu·ªëc m·ªõi
                </h1>
                <p class="text-sm text-slate-500 dark:text-slate-400">
                  T·∫°o ƒë∆°n thu·ªëc cho b·ªánh nh√¢n
                </p>
              </div>
            </div>
            <div class="flex items-center gap-3">
              <a
                href="/doctor/prescriptions"
                class="flex items-center gap-2 px-4 py-2 text-slate-600 dark:text-slate-400 hover:text-primary dark:hover:text-primary transition-colors"
              >
                <span class="material-symbols-outlined text-[20px]">history</span>
                <span class="hidden sm:inline">Xem l·ªãch s·ª≠ ƒë∆°n thu·ªëc</span>
              </a>
            </div>
          </div>
        </header>

        <!-- Content Area -->
        <main class="flex-1 overflow-y-auto p-6">
          <div class="max-w-5xl mx-auto">
            <form id="prescriptionForm" class="space-y-6">
              <!-- Hidden fields -->
              <input type="hidden" id="patientId" name="patientId" th:value="${patientId}" />
              <input type="hidden" id="doctorId" name="doctorId" th:value="${doctorId}" />

              <!-- Diagnosis Information Section -->
              <div
                class="bg-white dark:bg-[#1a2634] rounded-xl border border-slate-200 dark:border-slate-800 p-6"
              >
                <h2
                  class="text-lg font-semibold text-slate-900 dark:text-white mb-4 flex items-center gap-2"
                >
                  <span class="material-symbols-outlined text-primary">stethoscope</span>
                  Th√¥ng tin ch·∫©n ƒëo√°n
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <!-- Main Diagnosis -->
                  <div>
                    <label
                      for="mainDiagnosis"
                      class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"
                    >
                      Ch·∫©n ƒëo√°n ch√≠nh <span class="text-red-500">*</span>
                    </label>
                    <input
                      type="text"
                      id="mainDiagnosis"
                      name="diagnosis"
                      required
                      class="w-full px-4 py-2.5 bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-700 rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-colors"
                      placeholder="Nh·∫≠p ch·∫©n ƒëo√°n ch√≠nh..."
                    />
                  </div>
                  <!-- Symptoms -->
                  <div>
                    <label
                      for="symptoms"
                      class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"
                    >
                      Tri·ªáu ch·ª©ng
                    </label>
                    <input
                      type="text"
                      id="symptoms"
                      name="symptoms"
                      class="w-full px-4 py-2.5 bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-700 rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-colors"
                      placeholder="Nh·∫≠p tri·ªáu ch·ª©ng..."
                    />
                  </div>
                </div>
              </div>

              <!-- Medication List Section -->
              <div
                class="bg-white dark:bg-[#1a2634] rounded-xl border border-slate-200 dark:border-slate-800 p-6"
              >
                <div class="flex items-center justify-between mb-4">
                  <h2
                    class="text-lg font-semibold text-slate-900 dark:text-white flex items-center gap-2"
                  >
                    <span class="material-symbols-outlined text-primary">medication</span>
                    üíä Danh s√°ch thu·ªëc
                  </h2>
                  <button
                    type="button"
                    onclick="window.prescriptionCreate.addMedicationRow()"
                    class="flex items-center gap-2 px-4 py-2 bg-primary hover:bg-primary-dark text-white rounded-lg transition-colors text-sm font-medium"
                  >
                    <span class="material-symbols-outlined text-[20px]">add</span>
                    Th√™m thu·ªëc
                  </button>
                </div>

                <!-- Medication Table -->
                <div class="overflow-x-auto">
                  <table class="w-full" id="medicationTable">
                    <thead class="bg-slate-50 dark:bg-slate-800/50">
                      <tr>
                        <th
                          class="px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider"
                        >
                          STT
                        </th>
                        <th
                          class="px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider"
                        >
                          T√™n thu·ªëc
                        </th>
                        <th
                          class="px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider w-24"
                        >
                          SL
                        </th>
                        <th
                          class="px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider"
                        >
                          C√°ch d√πng
                        </th>
                        <th
                          class="px-4 py-3 text-center text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider w-16"
                        >
                          X√≥a
                        </th>
                      </tr>
                    </thead>
                    <tbody
                      id="medicationTableBody"
                      class="divide-y divide-slate-200 dark:divide-slate-800"
                    >
                      <!-- Medication rows will be inserted here -->
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- AI Assistant Suggestion Section -->
              <div
                id="aiSuggestionBox"
                class="bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl p-6 hidden"
              >
                <div class="flex items-start justify-between gap-4">
                  <div class="flex-1">
                    <div class="flex items-center gap-2 mb-3">
                      <span class="text-2xl">ü§ñ</span>
                      <h3
                        class="text-lg font-semibold text-amber-900 dark:text-amber-100"
                      >
                        G·ª£i √Ω t·ª´ AI Assistant
                      </h3>
                    </div>
                    <p
                      id="aiSuggestionText"
                      class="text-sm text-amber-800 dark:text-amber-200"
                    >
                      <!-- AI suggestion will be inserted here -->
                    </p>
                  </div>
                  <button
                    type="button"
                    id="applySuggestionBtn"
                    onclick="window.prescriptionCreate.applySuggestion()"
                    class="flex items-center gap-2 px-4 py-2 bg-amber-600 hover:bg-amber-700 text-white rounded-lg transition-colors text-sm font-medium whitespace-nowrap"
                  >
                    <span class="material-symbols-outlined text-[20px]">check</span>
                    √Åp d·ª•ng
                  </button>
                </div>
              </div>

              <!-- Notes & Follow-up Section -->
              <div
                class="bg-white dark:bg-[#1a2634] rounded-xl border border-slate-200 dark:border-slate-800 p-6"
              >
                <h2
                  class="text-lg font-semibold text-slate-900 dark:text-white mb-4 flex items-center gap-2"
                >
                  <span class="material-symbols-outlined text-primary">edit_note</span>
                  üìù L·ªùi d·∫∑n & H·∫πn t√°i kh√°m
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <!-- Doctor's Notes -->
                  <div>
                    <label
                      for="doctorNotes"
                      class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"
                    >
                      L·ªùi d·∫∑n c·ªßa b√°c sƒ©
                    </label>
                    <textarea
                      id="doctorNotes"
                      name="notes"
                      rows="4"
                      class="w-full px-4 py-2.5 bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-700 rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-colors resize-none"
                      placeholder="Nh·∫≠p ch·∫ø ƒë·ªô ƒÉn u·ªëng, sinh ho·∫°t, ki√™ng khem..."
                    ></textarea>
                  </div>

                  <!-- Follow-up Appointment -->
                  <div>
                    <label
                      for="followUpDate"
                      class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"
                    >
                      H·∫πn ng√†y t√°i kh√°m
                    </label>
                    <div class="relative">
                      <input
                        type="date"
                        id="followUpDate"
                        name="revisitDate"
                        class="w-full px-4 py-2.5 bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-700 rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-colors"
                      />
                      <span
                        class="material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none"
                      >
                        calendar_today
                      </span>
                    </div>
                    <p class="text-xs text-slate-500 dark:text-slate-400 mt-2 flex items-center gap-1">
                      <span>‚è∞</span>
                      T·ª± ƒë·ªông nh·∫Øc b·ªánh nh√¢n
                    </p>
                  </div>
                </div>
              </div>

              <!-- Form Actions -->
              <div class="flex items-center justify-between pt-4">
                <a
                  href="/doctor/prescriptions"
                  class="flex items-center gap-2 px-6 py-3 bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-lg transition-colors font-medium"
                >
                  <span class="material-symbols-outlined text-[20px]">arrow_back</span>
                  H·ªßy b·ªè
                </a>
                <button
                  type="submit"
                  id="submitBtn"
                  class="flex items-center gap-2 px-8 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg transition-colors font-semibold"
                >
                  <span class="material-symbols-outlined text-[20px]">save</span>
                  L∆∞u ƒë∆°n thu·ªëc
                </button>
              </div>
            </form>
          </div>
        </main>
      </div>
    </div>

    <!-- Toast Container -->
    <div
      id="toastContainer"
      class="fixed top-4 right-4 z-50 space-y-2"
    ></div>

    <!-- Scripts -->
    <script th:src="@{/js/modules/doctor/prescription-create.js}" type="module"></script>
    <script>
      // Sidebar toggle for mobile
      function toggleSidebar() {
        const sidebar = document.querySelector('aside');
        sidebar.classList.toggle('hidden');
      }

      // Global namespace for prescription create functions
      window.prescriptionCreate = {};

      // Initialize on page load
      document.addEventListener('DOMContentLoaded', function() {
        // Import and initialize the module
        import('/js/modules/doctor/prescription-create.js').then(module => {
          window.prescriptionCreate = module;
          module.init();
        });
      });
    </script>
  </body>
</html>
