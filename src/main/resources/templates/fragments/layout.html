<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <!-- 
    ABClinic Unified Layout System
    
    This file contains shared layout fragments for the entire application.
    All templates should use these fragments to maintain consistency.
    
    Usage:
      - Sidebar: th:replace="~{fragments/layout :: sidebar(role='admin', activeMenu='dashboard')}"
      - Header:  th:replace="~{fragments/layout :: header}"
      - Scripts: th:replace="~{fragments/layout :: scripts}"
    
    @version 2.0.0 - Unified Design System
    @date January 31, 2026
    -->
  </head>
  <body>
    <!-- ==================================================================================
         HEAD FRAGMENT - Common head elements
         ================================================================================== -->
    <th:block th:fragment="head(title)">
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title th:text="${title} + ' - ABClinic'">ABClinic</title>

      <!-- Google Fonts - Roboto (Primary) -->
      <link rel="preconnect" href="https://fonts.googleapis.com" />
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="" />
      <link
        href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&amp;display=swap"
        rel="stylesheet"
      />

      <!-- Material Symbols Outlined -->
      <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet"
      />

      <!-- Theme Controller - MUST be first to prevent flash -->
      <script th:src="@{/js/core/theme-controller.js}"></script>

      <!-- Tailwind CSS CDN (MUST be loaded BEFORE config) -->
      <script
        src="https://cdn.tailwindcss.com?plugins=forms,container-queries"
      ></script>
      <!-- Tailwind Config (MUST be loaded AFTER CDN) -->
      <script th:src="@{/js/config/tailwind-config.js}"></script>

      <!-- ABClinic Styles -->
      <link th:href="@{/css/core/app.css}" rel="stylesheet" />

      <style>
        /* Material Symbols Default Settings */
        .material-symbols-outlined {
          font-variation-settings:
            "FILL" 0,
            "wght" 400,
            "GRAD" 0,
            "opsz" 24;
          font-size: 24px;
        }
        .material-symbols-outlined.fill {
          font-variation-settings: "FILL" 1;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
          width: 6px;
          height: 6px;
        }
        ::-webkit-scrollbar-track {
          background: transparent;
        }
        ::-webkit-scrollbar-thumb {
          background: #cbd5e1;
          border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
          background: #94a3b8;
        }

        /* Sidebar Transition States */
        .sidebar-hidden {
          transform: translateX(-100%);
        }
        .sidebar-open {
          transform: translateX(0);
        }
        @media (min-width: 1024px) {
          .sidebar-hidden {
            transform: translateX(0);
          }
          .sidebar-collapsed {
            width: 4.5rem !important;
          }
          .sidebar-collapsed .sidebar-text {
            display: none !important;
          }
          .sidebar-collapsed .sidebar-logo-text {
            display: none !important;
          }
          /* Ensure icons stay visible and don't shrink */
          .sidebar-collapsed .menu-item .material-symbols-outlined {
            flex-shrink: 0;
            display: inline-flex !important;
          }
          /* Center icons and show tooltips for all menu items when collapsed */
          .sidebar-collapsed .menu-item {
            justify-content: center;
            padding-left: 0.75rem;
            padding-right: 0.75rem;
            position: relative;
            gap: 0 !important;
          }
          .sidebar-collapsed .menu-item:hover::after {
            content: attr(title);
            position: absolute;
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            margin-left: 0.5rem;
            padding: 0.5rem 0.75rem;
            background-color: #1e293b;
            color: white;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            white-space: nowrap;
            z-index: 50;
            pointer-events: none;
            box-shadow:
              0 4px 6px -1px rgba(0, 0, 0, 0.1),
              0 2px 4px -1px rgba(0, 0, 0, 0.06);
          }
          /* Hide user profile details when collapsed */
          .sidebar-collapsed .p-4 > a > .overflow-hidden {
            display: none !important;
          }
          .sidebar-collapsed .p-4 > a {
            justify-content: center;
          }
          /* Center logout button when collapsed */
          .sidebar-collapsed form button .sidebar-text {
            display: none !important;
          }
          .sidebar-collapsed form button {
            justify-content: center;
          }
        }
      </style>
    </th:block>

    <!-- ==================================================================================
         SIDEBAR BACKDROP (Mobile)
         ================================================================================== -->
    <div
      th:fragment="sidebar-backdrop"
      data-sidebar-backdrop
      class="fixed inset-0 bg-black/50 z-30 hidden lg:hidden"
      aria-hidden="true"
    ></div>

    <!-- ==================================================================================
         ADMIN SIDEBAR
         ================================================================================== -->
    <aside
      th:fragment="admin-sidebar"
      data-sidebar
      aria-label="Menu điều hướng chính"
      class="w-64 bg-white dark:bg-[#1a2634] border-r border-slate-200 dark:border-slate-800 flex flex-col shrink-0 transition-all duration-300 fixed lg:relative inset-y-0 left-0 z-40 sidebar-hidden lg:sidebar-open"
    >
      <!-- Logo Section -->
      <div
        class="h-16 flex items-center px-6 border-b border-slate-200 dark:border-slate-800"
      >
        <a
          th:href="@{/admin/dashboard}"
          class="flex items-center gap-2 text-primary"
        >
          <span class="material-symbols-outlined fill text-[28px]"
            >admin_panel_settings</span
          >
          <h1
            class="sidebar-text sidebar-logo-text text-xl font-bold tracking-tight text-slate-900 dark:text-white"
          >
            ABClinic
          </h1>
        </a>
      </div>

      <!-- Navigation Menu -->
      <div class="flex-1 overflow-y-auto py-4 px-3 space-y-1">
        <a
          class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white group transition-colors"
          data-path="/admin/dashboard"
          th:href="@{/admin/dashboard}"
          title="Bảng điều khiển"
        >
          <span class="material-symbols-outlined text-[20px]">dashboard</span>
          <span class="sidebar-text text-sm font-medium">Bảng điều khiển</span>
        </a>
        <a
          class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white group transition-colors"
          data-path="/admin/accounts"
          th:href="@{/admin/accounts}"
          title="Quản lý người dùng"
        >
          <span class="material-symbols-outlined text-[20px]"
            >manage_accounts</span
          >
          <span class="sidebar-text text-sm font-medium"
            >Quản lý người dùng</span
          >
        </a>
        <a
          class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white group transition-colors"
          data-path="/admin/reports"
          th:href="@{/reports}"
          title="Báo cáo"
        >
          <span class="material-symbols-outlined text-[20px]">assessment</span>
          <span class="sidebar-text text-sm font-medium"
            >Báo cáo & Thống kê</span
          >
        </a>
        <a
          class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white group transition-colors"
          data-path="/crm"
          th:href="@{/crm/tickets}"
          title="CRM"
        >
          <span class="material-symbols-outlined text-[20px]"
            >support_agent</span
          >
          <span class="sidebar-text text-sm font-medium">CRM & Hỗ trợ</span>
        </a>
        <a
          class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white group transition-colors"
          data-path="/ai"
          th:href="@{/ai/calls}"
          title="AI & Tích hợp"
        >
          <span class="material-symbols-outlined text-[20px]">smart_toy</span>
          <span class="sidebar-text text-sm font-medium">AI & Tích hợp</span>
        </a>
        <a
          class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white group transition-colors"
          data-path="/admin/settings"
          th:href="@{/admin/settings}"
          title="Cài đặt"
        >
          <span class="material-symbols-outlined text-[20px]">settings</span>
          <span class="sidebar-text text-sm font-medium">Cài đặt hệ thống</span>
        </a>
        <a
          class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white group transition-colors"
          data-path="/admin/profile"
          th:href="@{/admin/profile}"
          title="Hồ sơ cá nhân"
        >
          <span class="material-symbols-outlined text-[20px]">person</span>
          <span class="sidebar-text text-sm font-medium">Hồ sơ cá nhân</span>
        </a>
      </div>

      <!-- User Profile Section -->
      <div class="p-4 border-t border-slate-200 dark:border-slate-800">
        <a
          th:href="@{/admin/profile}"
          class="bg-slate-50 dark:bg-slate-800 rounded-lg p-3 flex items-center gap-3 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"
        >
          <div
            class="bg-primary rounded-full size-10 shrink-0 flex items-center justify-center text-white font-semibold"
          >
            <span
              th:if="${admin != null}"
              th:text="${admin.userInfo != null && admin.userInfo.fullName != null} ? ${admin.userInfo.fullName.substring(0,1)} : 'A'"
              >A</span
            >
            <span th:unless="${admin != null}">A</span>
          </div>
          <div class="overflow-hidden sidebar-text">
            <p
              class="text-sm font-bold text-slate-900 dark:text-white truncate"
              th:text="${admin != null && admin.userInfo != null} ? ${admin.userInfo.fullName} : 'Admin'"
            >
              Admin
            </p>
            <p class="text-xs text-slate-500 dark:text-slate-400 truncate">
              Quản trị viên
            </p>
          </div>
        </a>
        <form th:action="@{/auth/logout}" method="post" class="mt-3">
          <button
            type="submit"
            class="w-full flex items-center justify-center gap-2 px-3 py-2 text-sm text-slate-600 dark:text-slate-400 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors"
          >
            <span class="material-symbols-outlined text-[20px]">logout</span>
            <span class="sidebar-text">Đăng xuất</span>
          </button>
        </form>
      </div>

      <!-- Active menu highlight script -->
      <script>
        (function () {
          const currentPath = window.location.pathname;
          const menuItems = document.querySelectorAll(".menu-item");
          menuItems.forEach((item) => {
            const itemPath = item.getAttribute("data-path");
            if (itemPath && currentPath.startsWith(itemPath)) {
              item.classList.add(
                "bg-primary/10",
                "text-primary",
                "dark:text-primary",
              );
              item.classList.remove("text-slate-600", "dark:text-slate-400");
              const icon = item.querySelector(".material-symbols-outlined");
              if (icon) {
                icon.style.fontVariationSettings =
                  '"FILL" 1, "wght" 400, "GRAD" 0, "opsz" 24';
              }
            }
          });
        })();
      </script>
    </aside>

    <!-- ==================================================================================
         RECEPTIONIST SIDEBAR
         ================================================================================== -->
    <aside
      th:fragment="receptionist-sidebar"
      data-sidebar
      aria-label="Menu điều hướng chính"
      class="w-64 bg-white dark:bg-[#1a2634] border-r border-slate-200 dark:border-slate-800 flex flex-col shrink-0 transition-all duration-300 fixed lg:relative inset-y-0 left-0 z-40 sidebar-hidden lg:sidebar-open"
    >
      <!-- Logo Section -->
      <div
        class="h-16 flex items-center px-6 border-b border-slate-200 dark:border-slate-800"
      >
        <a
          th:href="@{/receptionist/dashboard}"
          class="flex items-center gap-2 text-primary"
        >
          <span class="material-symbols-outlined fill text-[28px]"
            >support_agent</span
          >
          <h1
            class="sidebar-text sidebar-logo-text text-xl font-bold tracking-tight text-slate-900 dark:text-white"
          >
            ABClinic
          </h1>
        </a>
      </div>

      <!-- Navigation Menu -->
      <div class="flex-1 overflow-y-auto py-4 px-3 space-y-1">
        <a
          class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white group transition-colors"
          data-path="/receptionist/dashboard"
          th:href="@{/receptionist/dashboard}"
          title="Bảng điều khiển"
        >
          <span class="material-symbols-outlined text-[20px]">dashboard</span>
          <span class="sidebar-text text-sm font-medium">Bảng điều khiển</span>
        </a>
        <a
          class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white group transition-colors"
          data-path="/receptionist/users"
          th:href="@{/receptionist/users}"
          title="Quản lý bệnh nhân"
        >
          <span class="material-symbols-outlined text-[20px]"
            >personal_injury</span
          >
          <span class="sidebar-text text-sm font-medium"
            >Quản lý bệnh nhân</span
          >
        </a>
        <a
          class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white group transition-colors"
          data-path="/receptionist/google-form-patients"
          th:href="@{/receptionist/google-form-patients}"
          title="Bệnh nhân Google Form"
        >
          <span class="material-symbols-outlined text-[20px]">quiz</span>
          <span class="sidebar-text text-sm font-medium">Bệnh nhân Google Form</span>
        </a>
        <a
          class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white group transition-colors"
          data-path="/receptionist/callbot"
          th:href="@{/receptionist/callbot}"
          title="Callbot AI"
        >
          <span class="material-symbols-outlined text-[20px]">call</span>
          <span class="sidebar-text text-sm font-medium">Callbot AI</span>
        </a>
        <a
          class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white group transition-colors"
          data-path="/receptionist/tickets"
          th:href="@{/receptionist/tickets}"
          title="Tickets"
        >
          <span class="material-symbols-outlined text-[20px]"
            >confirmation_number</span
          >
          <span class="sidebar-text text-sm font-medium">Ticket hỗ trợ</span>
        </a>
        <a
          class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white group transition-colors"
          data-path="/receptionist/patients"
          th:href="@{/receptionist/patients}"
          title="Bệnh nhân"
        >
          <span class="material-symbols-outlined text-[20px]">groups</span>
          <span class="sidebar-text text-sm font-medium">Bệnh nhân</span>
        </a>
        <a
          class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white group transition-colors"
          data-path="/doctor/knowledge"
          th:href="@{/doctor/knowledge}"
          title="Tri thức Y tế"
        >
          <span class="material-symbols-outlined text-[20px]">menu_book</span>
          <span class="sidebar-text text-sm font-medium">Tri thức Y tế</span>
        </a>
        <a
          class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white group transition-colors"
          data-path="/receptionist/profile"
          th:href="@{/receptionist/profile}"
          title="Hồ sơ cá nhân"
        >
          <span class="material-symbols-outlined text-[20px]">person</span>
          <span class="sidebar-text text-sm font-medium">Hồ sơ cá nhân</span>
        </a>
      </div>

      <!-- User Profile Section -->
      <div class="p-4 border-t border-slate-200 dark:border-slate-800">
        <a
          th:href="@{/receptionist/profile}"
          class="bg-slate-50 dark:bg-slate-800 rounded-lg p-3 flex items-center gap-3 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"
        >
          <div
            class="bg-primary rounded-full size-10 shrink-0 flex items-center justify-center text-white font-semibold"
          >
            <span
              th:if="${receptionist != null}"
              th:text="${receptionist.userInfo != null && receptionist.userInfo.fullName != null} ? ${receptionist.userInfo.fullName.substring(0,1)} : 'R'"
              >R</span
            >
            <span th:unless="${receptionist != null}">R</span>
          </div>
          <div class="overflow-hidden sidebar-text">
            <p
              class="text-sm font-bold text-slate-900 dark:text-white truncate"
              th:text="${receptionist != null && receptionist.userInfo != null} ? ${receptionist.userInfo.fullName} : 'Lễ tân'"
            >
              Lễ tân
            </p>
            <p class="text-xs text-slate-500 dark:text-slate-400 truncate">
              Lễ tân
            </p>
          </div>
        </a>
        <form th:action="@{/auth/logout}" method="post" class="mt-3">
          <button
            type="submit"
            class="w-full flex items-center justify-center gap-2 px-3 py-2 text-sm text-slate-600 dark:text-slate-400 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors"
          >
            <span class="material-symbols-outlined text-[20px]">logout</span>
            <span class="sidebar-text">Đăng xuất</span>
          </button>
        </form>
      </div>

      <!-- Active menu highlight script -->
      <script>
        (function () {
          const currentPath = window.location.pathname;
          const menuItems = document.querySelectorAll(".menu-item");
          menuItems.forEach((item) => {
            const itemPath = item.getAttribute("data-path");
            if (itemPath && currentPath.startsWith(itemPath)) {
              item.classList.add(
                "bg-primary/10",
                "text-primary",
                "dark:text-primary",
              );
              item.classList.remove("text-slate-600", "dark:text-slate-400");
              const icon = item.querySelector(".material-symbols-outlined");
              if (icon) {
                icon.style.fontVariationSettings =
                  '"FILL" 1, "wght" 400, "GRAD" 0, "opsz" 24';
              }
            }
          });
        })();
      </script>
    </aside>

    <!-- ==================================================================================
         PATIENT SIDEBAR
         ================================================================================== -->
    <aside
      th:fragment="patient-sidebar"
      data-sidebar
      aria-label="Menu điều hướng chính"
      class="w-64 bg-white dark:bg-[#1a2634] border-r border-slate-200 dark:border-slate-800 flex flex-col shrink-0 transition-all duration-300 fixed lg:relative inset-y-0 left-0 z-40 sidebar-hidden lg:sidebar-open"
    >
      <!-- Logo Section -->
      <div
        class="h-16 flex items-center px-6 border-b border-slate-200 dark:border-slate-800"
      >
        <a th:href="@{/patient}" class="flex items-center gap-2 text-primary">
          <span class="material-symbols-outlined fill text-[28px]"
            >local_hospital</span
          >
          <h1
            class="sidebar-text sidebar-logo-text text-xl font-bold tracking-tight text-slate-900 dark:text-white"
          >
            ABClinic
          </h1>
        </a>
      </div>

      <!-- Navigation Menu -->
      <div class="flex-1 overflow-y-auto py-4 px-3 space-y-1">
        <a
          class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white group transition-colors"
          data-path="/patient"
          th:href="@{/patient}"
          title="Tổng quan"
        >
          <span class="material-symbols-outlined text-[20px]">dashboard</span>
          <span class="sidebar-text text-sm font-medium">Tổng quan</span>
        </a>
        <a
          class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white group transition-colors"
          data-path="/patient/prescriptions"
          th:href="@{/patient/prescriptions}"
          title="Đơn thuốc"
        >
          <span class="material-symbols-outlined text-[20px]"
            >prescriptions</span
          >
          <span class="sidebar-text text-sm font-medium">Đơn thuốc</span>
        </a>
        <a
          class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white group transition-colors"
          data-path="/patient/treatments"
          th:href="@{/patient/treatments}"
          title="Kế hoạch điều trị"
        >
          <span class="material-symbols-outlined text-[20px]"
            >medical_services</span
          >
          <span class="sidebar-text text-sm font-medium"
            >Kế hoạch điều trị</span
          >
        </a>
        <a
          class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white group transition-colors"
          data-path="/patient/appointments"
          th:href="@{/patient/appointments}"
          title="Lịch hẹn"
        >
          <span class="material-symbols-outlined text-[20px]"
            >calendar_month</span
          >
          <span class="sidebar-text text-sm font-medium">Lịch hẹn</span>
        </a>
        <a
          class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white group transition-colors"
          data-path="/patient/tickets"
          th:href="@{/patient/tickets}"
          title="Yêu cầu hỗ trợ"
        >
          <span class="material-symbols-outlined text-[20px]"
            >confirmation_number</span
          >
          <span class="sidebar-text text-sm font-medium">Yêu cầu hỗ trợ</span>
        </a>
        <a
          class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white group transition-colors"
          data-path="/patient/documents"
          th:href="@{/patient/documents}"
          title="Tài liệu"
        >
          <span class="material-symbols-outlined text-[20px]">folder_open</span>
          <span class="sidebar-text text-sm font-medium">Tài liệu</span>
        </a>

        <!-- Divider -->
        <div class="border-t border-slate-200 dark:border-slate-700 my-3"></div>
        <p
          class="px-3 py-1 text-xs font-semibold text-slate-400 uppercase tracking-wider"
        >
          Hỗ trợ
        </p>

        <a
          class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white group transition-colors"
          data-path="/patient/call"
          th:href="@{/patient/call}"
          title="Gọi tư vấn"
        >
          <span class="material-symbols-outlined text-[20px]">call</span>
          <span class="sidebar-text text-sm font-medium">Gọi tư vấn</span>
        </a>

        <a
          class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white group transition-colors"
          data-path="/patient/profile"
          th:href="@{/patient/profile}"
          title="Hồ sơ cá nhân"
        >
          <span class="material-symbols-outlined text-[20px]">person</span>
          <span class="sidebar-text text-sm font-medium">Hồ sơ cá nhân</span>
        </a>
      </div>

      <!-- User Profile Section -->
      <div class="p-4 border-t border-slate-200 dark:border-slate-800">
        <a
          th:href="@{/patient/profile}"
          class="bg-slate-50 dark:bg-slate-800 rounded-lg p-3 flex items-center gap-3 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"
        >
          <div
            class="bg-primary rounded-full size-10 shrink-0 flex items-center justify-center text-white font-semibold"
          >
            <span
              th:if="${patient != null}"
              th:text="${patient.userInfo != null && patient.userInfo.fullName != null} ? ${patient.userInfo.fullName.substring(0,1)} : 'P'"
              >P</span
            >
            <span th:unless="${patient != null}">P</span>
          </div>
          <div class="overflow-hidden sidebar-text">
            <p
              class="text-sm font-bold text-slate-900 dark:text-white truncate"
              th:text="${patient != null && patient.userInfo != null && patient.userInfo.fullName != null} ? ${patient.userInfo.fullName} : (${session.userFullName} != null ? ${session.userFullName} : 'Bệnh nhân')"
            >
              Bệnh nhân
            </p>
            <p
              class="text-xs text-slate-500 dark:text-slate-400 truncate"
              th:text="${patient != null && patient.role != null} ? ${patient.role.name()} : 'Bệnh nhân'"
            >
              Bệnh nhân
            </p>
          </div>
        </a>
        <form th:action="@{/auth/logout}" method="post" class="mt-3">
          <button
            type="submit"
            class="w-full flex items-center justify-center gap-2 px-3 py-2 text-sm text-slate-600 dark:text-slate-400 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors"
          >
            <span class="material-symbols-outlined text-[20px]">logout</span>
            <span class="sidebar-text">Đăng xuất</span>
          </button>
        </form>
      </div>

      <!-- Active menu highlight script -->
      <script>
        (function () {
          const currentPath = window.location.pathname;
          const menuItems = document.querySelectorAll(".menu-item");
          menuItems.forEach((item) => {
            const itemPath = item.getAttribute("data-path");
            // Exact match for /patient to avoid matching all patient/* routes
            if (itemPath === "/patient" && currentPath === "/patient") {
              item.classList.add(
                "bg-primary/10",
                "text-primary",
                "dark:text-primary",
              );
              item.classList.remove("text-slate-600", "dark:text-slate-400");
              const icon = item.querySelector(".material-symbols-outlined");
              if (icon)
                icon.style.fontVariationSettings =
                  '"FILL" 1, "wght" 400, "GRAD" 0, "opsz" 24';
            } else if (
              itemPath !== "/patient" &&
              currentPath.startsWith(itemPath)
            ) {
              item.classList.add(
                "bg-primary/10",
                "text-primary",
                "dark:text-primary",
              );
              item.classList.remove("text-slate-600", "dark:text-slate-400");
              const icon = item.querySelector(".material-symbols-outlined");
              if (icon)
                icon.style.fontVariationSettings =
                  '"FILL" 1, "wght" 400, "GRAD" 0, "opsz" 24';
            }
          });
        })();
      </script>
    </aside>

    <!-- ==================================================================================
         HEADER FRAGMENT - DEPRECATED
         Use unified-header fragment instead: fragments/header/unified-header.html
         ================================================================================== -->
    <!-- Old header(title) fragment removed - replaced by unified-header -->

    <!-- ==================================================================================
         SCRIPTS FRAGMENT - Common JS includes
         ================================================================================== -->
    <th:block th:fragment="scripts">
      <!-- API Client - MUST load before notification-dropdown.js -->
      <script th:src="@{/js/core/api-client.js}"></script>

      <!-- Sidebar Controller -->
      <script th:src="@{/js/core/sidebar-controller.js}"></script>

      <!-- Theme Controller: Already loaded in <head> to prevent flash -->

      <!-- Notification Dropdown -->
      <script th:src="@{/js/core/notification-dropdown.js}"></script>

      <!-- App Core (Toast notifications) -->
      <script th:src="@{/js/core/app.js}"></script>
    </th:block>

    <!-- Legacy Sidebar Reference (for backward compatibility) -->
    <nav th:fragment="sidebar">
      <aside th:replace="~{fragments/layout :: admin-sidebar}"></aside>
    </nav>

    <!-- ==================================================================================
         TOP NAVBAR (Header) - DEPRECATED
         Use unified-header fragment instead: fragments/header/unified-header.html
         ================================================================================== -->
    <!-- Old navbar fragment removed - replaced by unified-header -->
  </body>
</html>
