<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Test Stringee Connection</title>
    <script src="/js/latest.sdk.bundle.min.js"></script>
    
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .status-box { padding: 15px; border: 1px solid #ccc; border-radius: 5px; margin-top: 10px; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <h2>Kiểm tra kết nối Stringee (Bước 3)</h2>

    <div class="status-box">
        <p>User ID trong Token: <b>test</b></p>
        <p>Trạng thái kết nối: <span id="connectStatus">Đang chờ...</span></p>
        <p>Trạng thái xác thực: <span id="authStatus">Đang chờ...</span></p>
    </div>

    <button onclick="connectStringee()" style="margin-top: 20px; padding: 10px 20px; cursor: pointer;">
        Bắt đầu Kết nối
    </button>

    <script>
        // Cấu hình Stringee Server Addresses (Best Practice)
        const STRINGEE_SERVER_ADDRS = [
            "wss://v1.stringee.com:6899/", 
            "wss://v2.stringee.com:6899/"
        ];
        
        // Token bạn vừa cung cấp
        const ACCESS_TOKEN = "eyJjdHkiOiJzdHJpbmdlZS1hcGk7dj0xIiwidHlwIjoiSldUIiwiYWxnIjoiSFMyNTYifQ.eyJqdGkiOiJTSy4wLjRVUlMxQnptUm1BczZXRjNqdEpnbkl5ZlNTUzFObmFSLTE3NjkwNzI0MzQiLCJpc3MiOiJTSy4wLjRVUlMxQnptUm1BczZXRjNqdEpnbkl5ZlNTUzFObmFSIiwiZXhwIjoxNzY5MDc2MDM0LCJ1c2VySWQiOiJ0ZXN0In0.B4D4HzUqnKZ3u5iA94OwfuFEKPAse8IlancO5VzXk20";

        function connectStringee() {
            const stringeeClient = new StringeeClient(STRINGEE_SERVER_ADDRS);

            // 1. Lắng nghe sự kiện connect
            stringeeClient.on('connect', function () {
                console.log('++++++++++++++ connected to StringeeServer');
                document.getElementById('connectStatus').innerText = 'Đã kết nối Server!';
                document.getElementById('connectStatus').className = 'success';
            });

            // 2. Lắng nghe sự kiện xác thực (authen)
            stringeeClient.on('authen', function (res) {
                console.log('authen', res);
                if (res.r === 0) {
                    document.getElementById('authStatus').innerText = 'Đăng nhập thành công (User: ' + res.userId + ')';
                    document.getElementById('authStatus').className = 'success';
                } else {
                    document.getElementById('authStatus').innerText = 'Lỗi xác thực: ' + res.message;
                    document.getElementById('authStatus').className = 'error';
                }
            });

            // 3. Lắng nghe sự kiện ngắt kết nối
            stringeeClient.on('disconnect', function () {
                console.log('++++++++++++++ disconnected');
                document.getElementById('connectStatus').innerText = 'Mất kết nối';
                document.getElementById('connectStatus').className = 'error';
            });

            // 4. Thực hiện kết nối với Token
            console.log('Bắt đầu kết nối...');
            stringeeClient.connect(ACCESS_TOKEN);
        }
    </script>
</body>
</html>
